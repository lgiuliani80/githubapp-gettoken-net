name: github-app-token-server
metadata:
  template: github-app-token-server@0.1.0

hooks:
  preprovision:
    posix:
      shell: sh
      run: |
        cp $GITHUB_PRIVATE_KEY_FILE .azure/$AZURE_ENV_NAME/github-private-key.pem
    windows:
      shell: pwsh
      run: |
        Copy-Item -Path $env:GITHUB_PRIVATE_KEY_FILE -Destination ".azure\$env:AZURE_ENV_NAME\github-private-key.pem"

# Required services
services:
  api:
    project: GithubApp-GetToken/GithubApp-GetToken.csproj
    host: appservice
    language: dotnet
    
# Azure infrastructure and supporting resources
infra:
  provider: bicep
  path: infra